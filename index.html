
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pony&#8217;s Stable</title>
  <meta name="author" content="Chienli Ma">

  
  <meta name="description" content="In this two weeks connection_pattern and infer_shape were merged. I was supposted to implemented the GPU optimization feature. As I don&rsquo;t have &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chienlima.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Pony's Stable" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Pony&#8217;s Stable</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="chienlima.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">HOME</a></li>
  <li><a href="/blog/catagory/">Catagory</a></li>
  <li><a href="/aboutme/">About me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/08/03/opfromgraph-dot-c-code/">OpfromGraph.c_code</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-03T11:04:09+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>11:04 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this two weeks <code>connection_pattern</code> and <code>infer_shape</code> were merged. I was supposted to implemented the GPU optimization feature. As I don&rsquo;t have a machine with Nvidia GPU, I truned to the <code>c_code</code> method after several days.</p>

<p>Reusing the code of <code>CLinker</code> would be our original idea. But thing wuold not be that simple. <code>CLinker</code> generate code at a function scale which mean it treat node <code>OpFromGraph</code> as a function. Yet we want to generate code at a OP scale. Therefore we need to remove some code in a larger scale to make <code>OpFromGraph.c_code()</code> return a &lsquo;node like&rsquo; c_code.</p>

<p>There&rsquo;re to solution. One is to add a new feature to <code>CLinker</code> so that it can detect <code>OpFromGraph</code> node and do some special behavior. The other one is to avoid high level method like <code>code_gen()</code> in <code>CLinker</code> &ndash; only use auxilary method to assemble a &lsquo;node like&rsquo; c_code. The later solution seems easier and I am working on it.  <code>CLinker</code> is a very complicated class, I try to understand it and work out a workable code in the next two weeks.</p>

<p>Wish myself good luck~~!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/18/put-hand-on-opfromgraph/">Putting Hand on OpFromGraph</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-18T18:01:35+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>6:01 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This two week, I start working on <code>OpFromGraph</code>. Which is the second part of the proposal.</p>

<p>Currently, if a FunctionGraph have repeated subgraph, theano will optimize these sub-graphs individually, which is not only a waste of computational resources but a waste of time. If we can extract a common structure in FunctionGraph and make it a <code>Op</code>, we can only optimize the sub-graph of this <code>Op</code> once and reuse it every where. This will speed up the optimization process. And <code>OpFromGraph</code> provides such feature.</p>

<p>To make <code>OpFromGraph</code> works well, it should support GPU and can be optimized. Following feature are expected:</p>

<ul>
<li><code>__eq__()</code> and <code>__hash__()</code></li>
<li><code>connection_pattern()</code> and &#8220;infer__shape()&#8220;`</li>
<li>Support GPU</li>
<li><code>c_code()</code></li>
</ul>


<p>I implement two feature in last two week: <code>connection_pattern</code> and <code>infer_shape</code>.  I hope I can make  <code>OpFromGraph</code> a useful feature at the end of this GSoC :).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/04/newpost/">Evaluation Passed and the Next Step: OpFromGraph</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-04T23:51:57+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:51 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Evaluation passed and the next step: OpFromGraph</p>

<p>The PR of <code>function.copy()</code> is ready to merged, only need fred to fix a small bug. And in this Friday I passed the mid-term evaluation. So it&rsquo;s time to take the next step.</p>

<p>In the original proposal ,the next step is to <code>swap output and updates</code>. After a discussion with Fred, we thought this feature is useless so we skip this and head to the next feature directly &ndash; <code>OpFromGraph</code>.</p>

<h2>Goal: </h2>

<p>make class <code>OpFromGraph</code> work.</p>

<h2>Big How?</h2>

<p> <code>OpFromGraph</code> should init a <code>gof.op</code> that has no difference with other <code>Op</code>s and can be optimized. Otherwise it has no sense.</p>

<p>For this, we need to make it work on GPU, make sure it works with C code and document it. Make sure <code>infer_shape()</code>, <code>grad()</code> work with it. Ideally, make <code>R_op()</code> work too.</p>

<h2>Detailed how.</h2>

<ul>
<li>Implement <code>__hash__()</code> and <code>__eq__()</code> method so it is a basic</li>
<li>Implement <code>infer_shape()</code> method so that it&rsquo;s optimizable</li>
<li>test if it work with shared variable as input and if not make it work. Add test for that.</li>
<li>Move it correctly to the GPU. We can do it quickly for the old back-end, move all float32 inputs to the GPU. Otherwise, we need to compile the inner function, see which inputs get moved to the GPU, then create a new OpFromGraph with the corresponding input to the GPU. <a href="https://github.com/Theano/Theano/pull/2982">#2982</a></li>
<li>Maker<code>grad()</code> work. This should remove the grad_depth parameter</li>
</ul>


<hr />

<h3>First Step: infer_shape:</h3>

<p>The main idea is to calculatet the shapes of outputs from given input shapes. This is a process similar to executing a function &ndash; we cannot know the shape of a variable before knowing the shape of the variables it depends on. So, we can mimic the <code>make_thunk()</code> method to calculate the shape from output to input. I come out with a draft now, and need some help with test case.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="o">.</span><span class="n">maker</span><span class="o">.</span><span class="n">fgraph</span><span class="o">.</span><span class="n">toposort</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c"># A dict that map variable to its shape(list)</span>
</span><span class='line'><span class="n">shape_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'><span class="c"># set the input shape of the fgraph</span>
</span><span class='line'><span class="k">for</span> <span class="n">in_var</span><span class="p">,</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">in_vars</span><span class="p">,</span> <span class="n">shapes</span><span class="p">);</span>
</span><span class='line'>    <span class="n">shape_map</span><span class="o">.</span><span class="n">set_default</span><span class="p">(</span><span class="n">in_var</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># calculate the output shape from input shape</span>
</span><span class='line'><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
</span><span class='line'>    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">var</span> <span class="ow">in</span> <span class="n">shape_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">inputs</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># calculate output shape</span>
</span><span class='line'>    <span class="n">in_shapes</span> <span class="o">=</span> <span class="p">[</span> <span class="n">shape_map</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">inputs</span><span class="p">]</span>
</span><span class='line'>    <span class="n">out_shapes</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">infer_shape</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">in_shapes</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># store the shape of that variable</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">out_var</span><span class="p">,</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span> <span class="n">out_shapes</span><span class="p">):</span>
</span><span class='line'>        <span class="n">shape_map</span><span class="o">.</span><span class="n">set_default</span><span class="p">(</span><span class="n">out_var</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c"># extract output shape</span>
</span><span class='line'><span class="k">return</span> <span class="p">[</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape_map</span><span class="p">[</span><span class="n">var</span><span class="p">])</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">fgraph</span><span class="o">.</span><span class="n">outputs</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/21/the-second-two-week/">The Second Two-week</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-21T00:09:54+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>12:09 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Almost forget to update a post.</p>

<p>In this two week, I finished the first feature &ldquo;Allow user to regenerate a function from compiled one&rdquo;, and this feature &ldquo;can be merged. But there&rsquo;s another PR need to rebase.&rdquo;  So, it&rsquo;s done.</p>

<p>Also, I get a draft of the code that allow user to swap SharedVariable. When I said &lsquo;draft&rsquo;, I mean that I&rsquo;ve finish the code as well as the testcase and they work. I&rsquo;ll make a PR for review at the beginning of next week. Also I have some new idea need to discuss with Fred.</p>

<p>I hope I can finish all 3 feature in the first 6-week: copy, swap_sharedvariable and delete_update. So that I can focus on OpFromGraph in the next half. It seems that someone has started working on it now. I hope he did not &lsquo;rob&rsquo; my job. :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/17/second-look-into-theano-core/">Second_look_into_Theano_core</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-17T19:26:55+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:26 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The first feature was done and is being reviewed! This post is my reading notes of theano core this week and how I implements the share_memory feature.</p>

<h2>Data sturctures</h2>

<h3>Function</h3>

<pre><code>Function is a callable object whose core is a function ```fn``` generate by linker. Every time a function is call, it will first examinate input data and then evaluate the ```fn``` to get output value.
</code></pre>

<p>PARAMETERS:</p>

<ul>
<li><strong>input/output_storages:</strong> two list of Container instance.</li>
<li><strong>maker:</strong> the maker of this function</li>
<li><strong>finder/inv_finder:</strong> provide mapping between <code>Container</code> and <code>In</code>( seems useless )</li>
<li><strong>fn:</strong> Core, what the real &lsquo;function&rsquo; is, a python function that evaluate graph.</li>
<li><strong>default and indices:</strong> List of tuples, partially useful. <code>default[i][2]</code> is <code>input_storage[i]</code> ;  <code>indices[i][0]</code> is <code>inputs[i]</code> in FunctionMaker.</li>
</ul>


<p>METHODS:</p>

<ul>
<li><code>__init__()</code>: Initialize input containers value and set up &ldquo;[]&rdquo; operator of container and self</li>
<li><code>__call__()</code>: verify input data types and then execute the <code>self.fn</code>. Pickup value in some of the the output storages and set up corresponding input_storage in there&rsquo;s updates.</li>
</ul>


<hr />

<h3>FunctionMaker</h3>

<pre><code>FunctionMaker is a Factory that create function. However, it's not like a factory very much cause every maker only corrsponds to one function. In FunctionMaker some important info of a theano.function are stored, such as Inputs/Outputs(represented by SymbolicKit), FunctionGraph.
</code></pre>

<p>PARAMS:</p>

<ul>
<li><strong>indices:</strong> ( almost deprecated, ignore )</li>
<li><strong>inputs:</strong> List of In() instances. In()</li>
<li><strong>output:</strong> List of Out() instances</li>
<li><strong>expanded_inputs:</strong> equals to inputs plus sharedvariables</li>
<li><strong>fgraph:</strong> FunctionGraph that represents the function it creates.</li>
<li><strong>Linker:</strong> Linker that link storage and apply method to create a <code>fn</code>. By default, <code>FAST_RUN</code> mode use <code>VM_Linker</code> , <code>FAST_COMPILE</code> uses <code>PerformLinker</code>.</li>
<li><strong>Optimizer, mode, profile &hellip;</strong>: some configuration that has less to do with my job</li>
</ul>


<p>METHOD:</p>

<ul>
<li><strong>create(input_storages):</strong> Given input_storages(by default, list of In.value), start the linker and link the function using <code>Linker.make_thunk()</code> return a theano.function.</li>
</ul>


<hr />

<h3>Linker/VM</h3>

<pre><code>Linker is a class that allocate storage for allpy_nodes and link them together. Understanding Linker and FunctionGraph definitely helps understands how theano works. The core method of Linker is make_thunk(). 
</code></pre>

<p>PARAMS:</p>

<ul>
<li><strong>fgraph</strong>: <code>FunctionGraph</code> accpeted by <code>Linker.accept()</code>.</li>
<li><strong>allow_gc,recycle&hellip;</strong>: some configuration bools</li>
</ul>


<p>METHODS:</p>

<ul>
<li><strong>make_thunk/all&hellip; :</strong>  <code>make_thunk()</code> is defined in class <code>Linker</code>. It calls method <code>make_all()</code>. Every subclass of linker will have slightly different implementation of <code>make_all()</code>. Bascially, at first, <code>make_all()</code> will toposort a fgraph, to acquire the <code>order</code> that apply_nodes should be executed. Next, it will call <code>Op.make_thunk()</code>, whick return a function. This function take input_storage of node, apply computation on them, and put result on output storage. Meanwhile, <code>make_all()</code> will allocate storage for all variables . Same variables in different node will have same storages. This is done by a dict <code>sotarge_map</code> that map variable to storage. At last, Linker return a function that executes list of thunks in certain order to acquire function outputs data.</li>
</ul>


<h3>Storage</h3>

<pre><code>Storage is quite a tricky thing in theano. Theano use a list with one element to be a storage. The element is true data. But all object only refer to the list. 
The list works like a pointer. When some objects refer to a storage, they refers to the list, not the true data. Therefore, modifying the data of storage will not change this reference. By doing this, theano can access and modify storage data from several places without change the reference relationship.
</code></pre>

<hr />

<h3>FunctionGraph</h3>

<pre><code>A representation of the computational graph of a function. It stores given the input and output variables of one function, by calling node.input and variable.owner recursively we can get the whole graph 
</code></pre>

<p>PARAMS:</p>

<ul>
<li><strong>features:</strong> Still Don&rsquo;t understand now, ignore it.</li>
<li><strong>input/output:</strong> List of input/output variabls.</li>
<li><strong>variables:</strong> Set of variables( all variables in the subgraph)</li>
<li><strong>apply_nodes:</strong> Set of apply_nodes in the subgraph defined by inputs and outputs</li>
</ul>


<p>METHODS</p>

<ul>
<li><code>__import_r__</code> and <code>__import__()</code>: import variable and apply_node to this fgraph.</li>
<li><code>clone_get_equiv</code> : Clone fgraph. Return new fgraph and a dict that map old variables to new variables.</li>
<li><code>replace()</code> : Replace all certain variables in fgraph by given new variables.</li>
</ul>


<hr />

<h2>How theano work?( Simplified version )</h2>

<h3>Without update:</h3>

<p>1.Input Variables will be wraped and become <code>In()</code>s. Each <code>In()</code> contains variable, it&rsquo;s value( defaults is none ) as well as some other configuration.
2.Generate fgraph by input and output variables, and then optimize it.
3.Linker toposorts fgraph to get an <code>order</code> of apply_nodes.Next, Linker allocates storages and links function based on this <code>order</code>.
4.Done</p>

<h3>With update:</h3>

<p>Update is given by a dict <code>{ ori_var:update_var ... }</code>. <code>Ori_var</code> is limited to be an SharedVariable therefore it will transfer into <code>In()</code> and become the input of this function. <code>update_var</code> will be add into the output of fgraph. Everytime a function called, the function  extract the storage of <code>update_var</code> and use it to set the value of corresponding input.</p>

<hr />

<h2>How to implement the share_memory feature?</h2>

<p>This is simple after understand how theano works. I implements it following sevaral steps:
1. Copy <code>In()</code> and <code>Out()</code> instances in Maker
2. Copy fgraph and get the dict <code>equiv</code> that map old variables to new variables
3. Copy old storage_map in <code>Function.fn.storage_map</code>
4. Modify copied storage_map accord to equiv, so that in the copied storage_map, new variables are mapped to old storage if memory need to be shared.
5. Reinitialize the maker, linke the function using the copied storage_map
6. Done</p>

<hr />

<p>Ok, basically this is the report of this week&rsquo;s work. Now I need to figure out how to implement the following features.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/16/first-gift-from-google/">First Gift From Google</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-16T16:12:52+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:12 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Several days a ago, I reveived a Fedex package. When I opened it &hellip; Bomb!</p>

<h4>Payoneer pre-paid MasterCard with Google icon on it!</h4>

<p><img src="/images/GSoCMasterCard.jpg" width="512" height="512" title="image" alt="images"></p>

<p>Good looking card. I guass someone will regret for using existing bank account.
Also this is my first own credit card. Finally I can make payment without a phone from my dad :)</p>

<p>Google is ready to pay me now. &ldquo;Are you OK?&rdquo;( Leijun&rsquo;s &lsquo;Chinglish&rsquo; )</p>

<hr />

<p>Kinda occupied in the last week. Luckily, I finished those buinesses. And now I am back again.
The first feature I will add to theano is a function that allow user to make a copy of function and allow functions run multi-theadedly. There exist two similar features: <code>pickle()</code> and <code>copy()</code> of a function. To figure how I need to work. I need to take 3 steps as preparation:</p>

<ul>
<li>Look into the code and see how function is generated <code>Done</code></li>
<li>Look into the code and understand <code>Function</code>, <code>FunctionMaker</code>, <code>Linker</code> and <code>FunctionGraph</code>. <code>next</code></li>
<li>Have a look at <code>pickle</code> and <code>copy()</code>, use them, figure out how them work and the differneces. Then think about my own idea.</li>
</ul>


<p>Ok, now I need to go and take the step two now.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/07/first-look-into-theano-core/">First Look Into Theano Core</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-07T11:08:32+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:08 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&rsquo;s been a week and a half since google-melange anounced the accepted student for google summer of code. I was luckcy enough to be accepted by Theano &ndash; sub-foundation of Python organization, to help them add new features: Allow user to modify compiled function. As scheduled, from 27th April to 23rd May is the community bounding period. During these days I ought to get familiar with Theano core code and Theano dev community.</p>

<p>Before the application started, I&rsquo;ve dived into Theano cored and got the basic idea of what I&#8217;am going to do. However, to make the idea more clear and to fit the requirement that student should post every week about their progress. I decide to write two post about Theano core &ndash; about how theano work. This is the first post. This post will talk about what is a function? And how a function is generate.</p>

<h2>How a function is generated?</h2>

<p> Just recall how we compiled a function <code>func = theano.function( [ inputs ], output )</code>, we can know that we should start out journey from method  <code>function()</code>, which locates in  <code>theano/compile/founction.py</code>.<br/>
 In method <code>function()</code>, after some data verification, it will call <code>orig_func()</code> or <code>pfunc()</code> which return a <code>function</code> that user will get. Since <code>pfunc()</code> will also call <code>orig_func()</code>, we are going to look into <code>pfunc()</code> first.</p>

<h3>pfunc.py</h3>

<p> <code>pfunc()</code> have two major tasks:</p>

<ul>
<li>Transfer input_variable into <code>In()</code> instances. So does <code>shared_variable</code>. ( In function graph,  SharedVariabls are treated as input, updates are treated as output ).</li>
<li>Rebuild computational graph using <code>updates</code> and <code>inputs</code>, transform output into <code>Out</code>  instances.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">pfunc</span><span class="p">(</span> <span class="o">...</span> <span class="n">some</span> <span class="n">arguments</span> <span class="o">...</span> <span class="p">):</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Clones the replacements named in the givens argument, and points each Var1 to</span>
</span><span class='line'>    <span class="c"># the clone of Var2.</span>
</span><span class='line'>    <span class="c"># Transform params into theano.compile.In objects.</span>
</span><span class='line'>    <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">_pfunc_param_to_in</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">allow_downcast</span><span class="o">=</span><span class="n">allow_input_downcast</span><span class="p">)</span>
</span><span class='line'>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">#  clones the outputs and the update expressions.  This rebuilds a computation graph</span>
</span><span class='line'>    <span class="c"># from the inputs and the givens. ( Irrelative to me. Pass )</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">output_vars</span> <span class="o">=</span> <span class="n">rebuild_collect_shared</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span>
</span><span class='line'>                                             <span class="n">in_variables</span><span class="p">,</span>
</span><span class='line'>                                             <span class="n">replace</span><span class="o">=</span><span class="n">givens</span><span class="p">,</span>
</span><span class='line'>                                             <span class="n">updates</span><span class="o">=</span><span class="n">updates</span><span class="p">,</span>
</span><span class='line'>                                             <span class="n">rebuild_strict</span><span class="o">=</span><span class="n">rebuild_strict</span><span class="p">,</span>
</span><span class='line'>                                             <span class="n">copy_inputs_over</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
</span><span class='line'>                                             <span class="n">no_default_updates</span><span class="o">=</span><span class="n">no_default_updates</span><span class="p">)</span>
</span><span class='line'>    <span class="c"># extracting the arguments</span>
</span><span class='line'>    <span class="n">input_variables</span><span class="p">,</span> <span class="n">cloned_outputs</span><span class="p">,</span> <span class="n">other_stuff</span> <span class="o">=</span> <span class="n">output_vars</span>
</span><span class='line'>    <span class="n">clone_d</span><span class="p">,</span> <span class="n">update_d</span><span class="p">,</span> <span class="n">update_expr</span><span class="p">,</span> <span class="n">shared_inputs</span> <span class="o">=</span> <span class="n">other_stuff</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">iv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">input_variables</span><span class="p">):</span>
</span><span class='line'>        <span class="n">i</span><span class="o">.</span><span class="n">variable</span> <span class="o">=</span> <span class="n">iv</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="n">sv</span> <span class="ow">in</span> <span class="n">shared_inputs</span><span class="p">:</span>
</span><span class='line'>        <span class="c"># pass value of None here</span>
</span><span class='line'>        <span class="c"># value will be stored in the resulting functions&#39; defaults list</span>
</span><span class='line'>        <span class="c"># but since the value of shared variables never needs to be refed, it is not needed</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">sv</span> <span class="ow">in</span> <span class="n">update_d</span><span class="p">:</span>
</span><span class='line'>            <span class="n">si</span> <span class="o">=</span> <span class="n">In</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="n">sv</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">sv</span><span class="o">.</span><span class="n">container</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">borrow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="n">update_d</span><span class="p">[</span><span class="n">sv</span><span class="p">],</span> <span class="n">shared</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">si</span> <span class="o">=</span> <span class="n">In</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="n">sv</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">sv</span><span class="o">.</span><span class="n">container</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">mutable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">borrow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="n">inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">orig_function</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">cloned_outputs</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span>
</span><span class='line'>            <span class="n">accept_inplace</span><span class="o">=</span><span class="n">accept_inplace</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span>
</span><span class='line'>            <span class="n">on_unused_input</span><span class="o">=</span><span class="n">on_unused_input</span><span class="p">,</span> <span class="n">output_keys</span><span class="o">=</span><span class="n">output_keys</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>orig_func():</h3>

<p>Now it time for a look into <code>orig_func()</code>.  <code>orig_func()</code> will again makes sure that inputs and outputs are transformed into <code>In</code> an <code>Out</code>. And then it will use <code>create</code> method in <code>FunctionMaker</code> to make a function, which will be return.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">orig_function</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">accept_inplace</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
</span><span class='line'>                  <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">on_unused_input</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
</span><span class='line'>                  <span class="n">output_keys</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># conver input variable into instances of In() instances</span>
</span><span class='line'>    <span class="n">inputs</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">convert_function_input</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># so do outputs</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">outputs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span class='line'>            <span class="n">outputs</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">FunctionMaker</span><span class="o">.</span><span class="n">wrap_out</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">outputs</span> <span class="o">=</span> <span class="n">FunctionMaker</span><span class="o">.</span><span class="n">wrap_out</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># In()s and Out()s will be passed into FunctionMaker and a function will be create from it by calling create() method.</span>
</span><span class='line'>    <span class="n">fn</span> <span class="o">=</span> <span class="n">Maker</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span>
</span><span class='line'>                   <span class="n">outputs</span><span class="p">,</span>
</span><span class='line'>                   <span class="n">mode</span><span class="p">,</span>
</span><span class='line'>                   <span class="n">accept_inplace</span><span class="o">=</span><span class="n">accept_inplace</span><span class="p">,</span>
</span><span class='line'>                   <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span>
</span><span class='line'>                   <span class="n">on_unused_input</span><span class="o">=</span><span class="n">on_unused_input</span><span class="p">,</span>
</span><span class='line'>                   <span class="n">output_keys</span> <span class="o">=</span> <span class="n">output_keys</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span><span class='line'>                       <span class="n">defaults</span><span class="p">)</span>         <span class="c">#     ^^^^ </span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>FunctionMaker:</h3>

<p> <code>FunctionMaker.__init()__</code> is where <code>fgraph</code> is extracted and optimized. <code>FuncitonMaker.create()</code> is where <code>function</code> will be compiled and linked. In fact, <code>FunctionMaker.linker.make_thunk()</code> is where <code>function</code> is linked.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">FunctionMaker</span><span class="p">:</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="o">...</span><span class="n">args</span><span class="o">...</span> <span class="p">):</span>
</span><span class='line'>        <span class="c"># again, make sure that input/output are tranformed into In and Out</span>
</span><span class='line'>        <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrap_in</span><span class="p">,</span> <span class="n">inputs</span><span class="p">),</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrap_out</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># ???</span>
</span><span class='line'>        <span class="n">_inputs</span> <span class="o">=</span> <span class="n">gof</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">inputs</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">variable</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">update</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inputs</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s">&#39;update&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)])</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># make indices ... which is useless</span>
</span><span class='line'>        <span class="n">indices</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">input</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_in</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">_inputs</span><span class="p">)</span> <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># get fgraph</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">fgraph</span> <span class="ow">is</span> <span class="n">Node</span><span class="p">:</span>
</span><span class='line'>            <span class="n">fgraph</span><span class="p">,</span> <span class="n">additional_outputs</span> <span class="o">=</span> <span class="n">std_fgraph</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">accept_inplace</span><span class="p">)</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">_</span><span class="p">,</span> <span class="n">additional_outputs</span> <span class="o">=</span> <span class="n">std_fgraph</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">accept_inplace</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">fgraph</span> <span class="o">=</span> <span class="n">fgraph</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># fetch optimizor and linker</span>
</span><span class='line'>        <span class="n">optimizer</span><span class="p">,</span> <span class="n">linker</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mode</span><span class="o">.</span><span class="n">linker</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># optimize fgraph</span>
</span><span class='line'>        <span class="c"># if need_opt:</span>
</span><span class='line'>            <span class="c"># optimization code here</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># linker accept fgraph </span>
</span><span class='line'>        <span class="k">if</span> <span class="n">no_borrow</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">linker</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">fgraph</span><span class="p">,</span> <span class="n">no_recycling</span><span class="o">=</span><span class="n">infer_reuse_pattern</span><span class="p">(</span><span class="n">fgraph</span><span class="p">,</span> <span class="n">no_borrow</span><span class="p">))</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">linker</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">fgraph</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">linker</span><span class="p">,</span> <span class="s">&#39;accept_var_updates&#39;</span><span class="p">):</span>
</span><span class='line'>            <span class="c"># hacky thing so VMLinker knows about updates</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">linker</span><span class="o">.</span><span class="n">accept_var_updates</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">fgraph_updated_vars</span><span class="p">(</span><span class="n">fgraph</span><span class="p">,</span> <span class="n">inputs</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># some other configeration here</span>
</span><span class='line'>        <span class="c"># ...</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_storage</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">trustme</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Create a function.</span>
</span><span class='line'>
</span><span class='line'><span class="sd">    Input storage is the &#39;value&#39; attribute of each In instances</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># construct input_storage_list and default list</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">((</span><span class="nb">input</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">subinputs</span><span class="p">),</span> <span class="n">input_storage_i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">input_storage</span><span class="p">)):</span>
</span><span class='line'>            <span class="c"># a lot of codes here.</span>
</span><span class='line'>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">        Q: What&#39;s indices?</span>
</span><span class='line'><span class="sd">        List of (SymbolicInput, incide, [SymbolicInput..]). The first one is the </span>
</span><span class='line'><span class="sd">        input vaiable; the incide is the index of the input in the input list; </span>
</span><span class='line'><span class="sd">        the [SymIn...] the relevant input(?); </span>
</span><span class='line'><span class="sd">        According to the document, the last two is deprecated. So it can be regarded as list of SymbolicInput.</span>
</span><span class='line'><span class="sd">    </span>
</span><span class='line'><span class="sd">        Q: What&#39;s defaults?</span>
</span><span class='line'><span class="sd">        A: List of 3-tuples. Each tuple corresponds to one input_storage. </span>
</span><span class='line'><span class="sd">        ( </span>
</span><span class='line'><span class="sd">          Bool: Is this input required at each function call?,  </span>
</span><span class='line'><span class="sd">          Bool: Should this inputs value be reverted to default value after each call? </span>
</span><span class='line'><span class="sd">          AnyType: The value(storage) associated with this input.</span>
</span><span class='line'><span class="sd">        )</span>
</span><span class='line'><span class="sd">        &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># call make_thunk() from linker and get fn</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">theano</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">traceback</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>            <span class="n">_fn</span><span class="p">,</span> <span class="n">_i</span><span class="p">,</span> <span class="n">_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linker</span><span class="o">.</span><span class="n">make_thunk</span><span class="p">(</span><span class="n">input_storage</span><span class="o">=</span><span class="n">input_storage_lists</span><span class="p">)</span>
</span><span class='line'>            <span class="c"># ^   ^   ^ =&gt; (function, input_containers, output_containers)</span>
</span><span class='line'>            <span class="c"># where function is a thunk that operates on the returned variables.</span>
</span><span class='line'>            <span class="c"># Because the map_storag() in make_thunk()</span>
</span><span class='line'>            <span class="c"># from here on, the input/output_storage represent all I/O of all relative nodes</span>
</span><span class='line'>            <span class="c"># ALso, storage is container, Instead of SymbolicKit</span>
</span><span class='line'>        <span class="k">finally</span><span class="p">:</span>
</span><span class='line'>            <span class="n">theano</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">traceback</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit_orig</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># get a function, here function_builder() is the constructor</span>
</span><span class='line'>        <span class="c"># of class Function.</span>
</span><span class='line'>        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_builder</span><span class="p">(</span><span class="n">_fn</span><span class="p">,</span> <span class="n">_i</span><span class="p">,</span> <span class="n">_o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">defaults</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_single</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_none</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_keys</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">fn</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h2>What&rsquo;s <code>theano.function</code>?</h2>

<p>Each function is a callable object.  <code>theano.function</code> is not a python function. Instead, it a class with method <code>__call__()</code>.  Every funciton stores its own fgraph, maker, storages and many other configurations. However, the core of a function is a function <code>fn()</code> returned by <code>linker.make_thunk()</code>. Every time a function is called, it will first verify the input data, and then call <code>self.fn()</code> to get output values.</p>

<hr />

<p>Now I know how is a function borned. Also, I know that to complete my missions, I need to focus more on <code>FunctionMaker</code> and <code>Function</code> rather that <code>orig_func()</code> and <code>pfunc()</code>. However, there still exist some question, such as: What does <code>make_thunk()</code> do? and What is <code>In()</code>, <code>Out()</code> and <code>container</code>? In the next post, I will have a look at this and other relative data structures.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/30/leetcode-start-coding-with-c-plus-plus/">Leetcode battlefield:Start Coding With C++</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-30T00:24:06+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:24 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So, the buggy judging system of python is unbearable, therefore I just turned to C++ and expected a better experience. Also, I need to learn  C++ for my future career. So, a good start. This post contains following problems:</p>

<ul>
<li>Reverse words</li>
<li>Eval RPN</li>
<li>Tree Traversal</li>
</ul>


<hr />

<h3>Reverse words</h3>

<p>Before solving this problem I never tried using std::string, I thought string operation in C++ is as hard as C. However, standard library really ease my pains. In fact, with the help of std, I think coding with C++ is much more easier and happier than coding with Ruby and Python now.</p>

<h5>Question:</h5>

<p>Given an input string, reverse the string word by word.</p>

<h5>Basic logic:</h5>

<p>The idea is simple, find each word in the sentence, push then in the stack and pop back after dealing the whole sentence. Be careful to the spaces in the head or tails of the sentence and the repeated spaces.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="k">class</span> <span class="nc">Solution</span> <span class="p">{</span>
</span><span class='line'><span class="k">public</span><span class="o">:</span>
</span><span class='line'>    <span class="kt">void</span> <span class="n">reverseWords</span><span class="p">(</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span> <span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// get the words in reverse order</span>
</span><span class='line'>        <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">words</span><span class="p">;</span>
</span><span class='line'>        <span class="n">split</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="n">words</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">// reconstruct</span>
</span><span class='line'>        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="n">words</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span><span class="k">return</span><span class="p">;</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">words</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">s</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>            <span class="n">s</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// delete last space</span>
</span><span class='line'>        <span class="n">s</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span> <span class="n">s</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="n">split</span><span class="p">(</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="kt">char</span> <span class="n">c</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">v</span> <span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">begin</span><span class="p">,</span> <span class="n">last</span><span class="p">;</span>
</span><span class='line'>        <span class="c1">// first word</span>
</span><span class='line'>        <span class="n">begin</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">-</span><span class="mi">1</span> <span class="p">;</span>
</span><span class='line'>        <span class="n">last</span>  <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">find_last_of</span><span class="p">(</span> <span class="n">c</span><span class="p">,</span> <span class="n">begin</span> <span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="n">s</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span> <span class="n">last</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">begin</span><span class="o">-</span><span class="n">last</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span> <span class="n">last</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">begin</span><span class="o">-</span><span class="n">last</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// find next words</span>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span> <span class="n">last</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="n">and</span> <span class="n">begin</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="c1">// find a word </span>
</span><span class='line'>            <span class="n">begin</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>            <span class="n">last</span>  <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">find_last_of</span><span class="p">(</span> <span class="n">c</span><span class="p">,</span> <span class="n">begin</span> <span class="p">);</span>
</span><span class='line'>            <span class="c1">// if it&#39;s repeated split character, skip it</span>
</span><span class='line'>            <span class="k">while</span><span class="p">(</span> <span class="n">last</span> <span class="o">==</span> <span class="n">begin</span> <span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">begin</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>                <span class="n">last</span>  <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">find_last_of</span><span class="p">(</span> <span class="n">c</span><span class="p">,</span> <span class="n">begin</span> <span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="c1">// skip if is last space</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span> <span class="n">s</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span> <span class="n">last</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">begin</span><span class="o">-</span><span class="n">last</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span> <span class="n">last</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">begin</span><span class="o">-</span><span class="n">last</span><span class="p">));</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>evalRPN</h3>

<h5>Question:</h5>

<p>Evaluate the value of an arithmetic expression in Reverse Polish Notation. For example:
    [&ldquo;2&rdquo;, &ldquo;1&rdquo;, &ldquo;+&rdquo;, &ldquo;3&rdquo;, &ldquo;*&rdquo;] -> ((2 + 1) * 3) -> 9</p>

<h5>Basic logic:</h5>

<p>Also simple idea: Iterater through the list, push numbers to a stack. Everytime we meet operaor, pop top 2 numbers and calculate the result, push the result to the stack. Finally, there will be only one number in the stack, which is the reuslt.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='C++'><span class='line'><span class="k">class</span> <span class="nc">Solution</span> <span class="p">{</span>
</span><span class='line'><span class="k">public</span><span class="o">:</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">evalRPN</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">tokens</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">resultStack</span><span class="p">;</span>
</span><span class='line'>        <span class="n">string</span> <span class="n">symbol</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">bool</span> <span class="n">isOperator</span><span class="p">;</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">tokens</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">symbol</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>            <span class="n">isOperator</span> <span class="o">=</span>  <span class="n">symbol</span><span class="o">==</span><span class="s">&quot;+&quot;</span><span class="o">||</span><span class="n">symbol</span><span class="o">==</span><span class="s">&quot;-&quot;</span><span class="o">||</span><span class="n">symbol</span><span class="o">==</span><span class="s">&quot;*&quot;</span><span class="o">||</span><span class="n">symbol</span><span class="o">==</span><span class="s">&quot;/&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="n">isOperator</span> <span class="p">)</span>
</span><span class='line'>                <span class="n">resultStack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">stoi</span><span class="p">(</span><span class="n">symbol</span><span class="p">));</span>
</span><span class='line'>            <span class="k">else</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">right</span> <span class="o">=</span> <span class="n">resultStack</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
</span><span class='line'>                <span class="n">resultStack</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
</span><span class='line'>                <span class="n">left</span> <span class="o">=</span> <span class="n">resultStack</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
</span><span class='line'>                <span class="n">resultStack</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="n">symbol</span><span class="o">==</span><span class="s">&quot;+&quot;</span><span class="p">)</span>
</span><span class='line'>                    <span class="n">result</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">;</span>
</span><span class='line'>                <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">symbol</span> <span class="o">==</span><span class="s">&quot;-&quot;</span><span class="p">)</span>
</span><span class='line'>                    <span class="n">result</span> <span class="o">=</span> <span class="n">left</span> <span class="o">-</span> <span class="n">right</span><span class="p">;</span>
</span><span class='line'>                <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">symbol</span><span class="o">==</span><span class="s">&quot;*&quot;</span><span class="p">)</span>
</span><span class='line'>                    <span class="n">result</span> <span class="o">=</span> <span class="n">left</span> <span class="o">*</span> <span class="n">right</span><span class="p">;</span>
</span><span class='line'>                <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">symbol</span><span class="o">==</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
</span><span class='line'>                    <span class="n">result</span> <span class="o">=</span> <span class="n">left</span> <span class="o">/</span> <span class="n">right</span><span class="p">;</span>
</span><span class='line'>                <span class="k">else</span>
</span><span class='line'>                    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;ERROR&quot;</span><span class="p">;</span>
</span><span class='line'>                <span class="n">resultStack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">resultStack</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>Tree traversal</h3>

<h5>Basic logic:</h5>

<p>Basic algo. There are 3 kind of traversal method: postorder, preorder and inorder.</p>

<h5>PostOrder</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Solution</span> <span class="p">{</span>
</span><span class='line'><span class="k">public</span><span class="o">:</span>
</span><span class='line'>    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">postorderTraversal</span><span class="p">(</span><span class="n">TreeNode</span> <span class="o">*</span><span class="n">root</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="n">root</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">){</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span><span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span> <span class="n">root</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">){</span>
</span><span class='line'>                <span class="n">travel</span><span class="p">(</span> <span class="n">root</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">,</span> <span class="n">v</span> <span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span> <span class="n">root</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">){</span>
</span><span class='line'>                <span class="n">travel</span><span class="p">(</span> <span class="n">root</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">,</span> <span class="n">v</span> <span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">root</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="kt">void</span> <span class="n">travel</span><span class="p">(</span> <span class="n">TreeNode</span> <span class="o">*</span><span class="n">node</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">v</span> <span class="p">){</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">){</span>
</span><span class='line'>            <span class="n">travel</span><span class="p">(</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">,</span> <span class="n">v</span> <span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">){</span>
</span><span class='line'>            <span class="n">travel</span><span class="p">(</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">,</span> <span class="n">v</span> <span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h5>PreOrder</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Solution</span> <span class="p">{</span>
</span><span class='line'><span class="k">public</span><span class="o">:</span>
</span><span class='line'>    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">preorderTraversal</span><span class="p">(</span><span class="n">TreeNode</span> <span class="o">*</span><span class="n">root</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="n">root</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="p">){</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">root</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="n">root</span><span class="o">-&gt;</span><span class="n">left</span> <span class="p">){</span>
</span><span class='line'>            <span class="n">travel</span><span class="p">(</span> <span class="n">root</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">,</span> <span class="n">v</span> <span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="n">root</span><span class="o">-&gt;</span><span class="n">right</span> <span class="p">){</span>
</span><span class='line'>            <span class="n">travel</span><span class="p">(</span> <span class="n">root</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="n">travel</span><span class="p">(</span><span class="n">TreeNode</span> <span class="o">*</span><span class="n">node</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">){</span>
</span><span class='line'>        <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span> <span class="p">){</span>
</span><span class='line'>            <span class="n">travel</span><span class="p">(</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">,</span> <span class="n">v</span> <span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span> <span class="p">){</span>
</span><span class='line'>            <span class="n">travel</span><span class="p">(</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/30/leetcode-some-python-codes/">Leetcode battlefield:Some Python Codes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-30T00:22:37+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:22 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I collected a bunches of leetcode code solutions and now put them in one post. This post contains the following questions:</p>

<pre><code>* BST Iterator
* Factorial Trailing Zeros
* Excel number
* Decimal
* Find Peak Element
* Min stack
* Majority elements
* Trailing zeros
* Tree Travel
</code></pre>

<p>Also, after realing leetcode online judge have numerous bug in python test case, I decided to turn to C++. So, here comes the solutions.</p>

<hr />

<h3>BST Iterator</h3>

<h5>Question:</h5>

<p>Implement an iterator over a binary search tree (BST). Your iterator will be initialized with the root node of a BST.
Calling <code>next()</code> will return the next smallest number in the BST.
Note: <code>next()</code> and <code>hasNext()</code> should run in average <code>O(1)</code> time and uses <code>O(h)</code> memory, where h is the height of the tree.</p>

<h5>Basic logic:</h5>

<p>The smallest value is will be on the left-most node, therefore the first thing to do is to dive to the deepest ad left-most of the tree. Next we can return the value of the middle node, then its left node. A list of nodes on path should be maintain to avoid return repeated value.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">BSTIterator</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># @param root, a binary search tree&#39;s root node</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># ancestors of current node, </span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># current node, initialized by root</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">None</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># current point to the  smallest value</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">root</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">dive</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># @return a boolean, whether we have a next smallest number</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">hasNext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">!=</span> <span class="bp">None</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">hasLeft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasNext</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">hasRight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasNext</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># @return an integer, the next smallest number</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># every time we dive first,</span>
</span><span class='line'>        <span class="c"># so the smallest value is the current node</span>
</span><span class='line'>        <span class="n">rval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">val</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasRight</span><span class="p">():</span>
</span><span class='line'>            <span class="c"># if no right nodes</span>
</span><span class='line'>            <span class="c"># the next smallest value will be current node&#39;s parent</span>
</span><span class='line'>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>                <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">None</span>
</span><span class='line'>            <span class="k">else</span><span class="p">:</span>
</span><span class='line'>                <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="c"># if there is right node,  it&#39;s value will smaller than parent&#39;s, </span>
</span><span class='line'>            <span class="c"># so step into it, then dive to left-most</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">right</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">dive</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">rval</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">dive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasLeft</span><span class="p">():</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="p">)</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">left</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>Excel column number</h3>

<h5>Qusetion</h5>

<p>Given Excel column number, return the corresponding digit number</p>

<h5>Basic logic</h5>

<p>A conversion of number systems( thought not a typical one) . First we map characters to numbers, them multiply digit in the <code>Nth</code> location with <code>26^n</code>, sum and get the result.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># @param s, a string</span>
</span><span class='line'>    <span class="c"># @return an integer</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span><span class="s">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">titleToNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span class='line'>        <span class="n">rval</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
</span><span class='line'>            <span class="c"># need to revese the string</span>
</span><span class='line'>            <span class="n">rval</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">char2Int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">26</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">rval</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">char2Int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">char</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>Majority element</h3>

<h6>Question:</h6>

<p>Given an array of size n, find the majority element. The majority element is the element that appears more than <code>n/2</code> times.</p>

<h6>Basic logic:</h6>

<p>Use a counter(map) to calculate how many times each elements has occured and return if <code>times &gt; length/2</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># @param num, a list of integers</span>
</span><span class='line'>    <span class="c"># @return an integer</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">majorityElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
</span><span class='line'>        <span class="nb">map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>        <span class="n">length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">num</span><span class="p">:</span>
</span><span class='line'>            <span class="k">try</span><span class="p">:</span>
</span><span class='line'>                <span class="nb">map</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>            <span class="k">except</span><span class="p">:</span>
</span><span class='line'>                <span class="nb">map</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>            <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
</span><span class='line'>                <span class="k">return</span> <span class="n">n</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>Trailing zeros.</h3>

<h5>Question:</h5>

<p>Given an integer n, return the number of trailing zeroes in n!.</p>

<h5>Basic logics:</h5>

<p>This is more a math problem than a code problem. Notice that <code>1 x 2 x 3 ... x 5 ... x 10 ...</code> with every <code>5</code>( or <code>n x 5</code> ) there must be a <code>2</code>(or<code>nx2</code>). And the trailing zeros must be the result of <code>(2x5)^n</code>. Therefore, the problem becomes &lsquo;How many 5 are there in it&rsquo;s factors&rsquo;. ( Need to rewrite this paragraph )</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># @return an integer</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">trailingZeroes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span class='line'>        <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>        <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>        <span class="k">while</span> <span class="mi">5</span><span class="o">**</span><span class="n">k</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
</span><span class='line'>            <span class="n">num</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="mi">5</span><span class="o">**</span><span class="n">k</span><span class="p">))</span>
</span><span class='line'>            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">num</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<hr />

<h3>Find peak elements</h3>

<h6>Questions</h6>

<p>Given an input array where num[i] ≠ num[i+1], find a peak element and return its index.</p>

<h6>Basic logic</h6>

<p>Easy problem, just iter over and compare each element with its neighbours. If the num[i] can equals num[i+], we first deduplicate, and then compare. Need some attentions on the conner case( length = 0,1 or the peak occurs on the head or tails)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># @param num, a list of integer</span>
</span><span class='line'>    <span class="c"># @return an integer</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">findMin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">num</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="c"># deduplicate</span>
</span><span class='line'>            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">num</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span class='line'>                <span class="n">num</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)):</span>
</span><span class='line'>                <span class="k">try</span><span class="p">:</span>
</span><span class='line'>                    <span class="k">if</span> <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
</span><span class='line'>                        <span class="n">num</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>                <span class="k">except</span><span class="p">:</span>
</span><span class='line'>                    <span class="k">break</span>
</span><span class='line'>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">findMinNoRepeat</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">findMinNoRepeat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">num</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">buf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span class='line'>                <span class="n">buf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
</span><span class='line'>                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>            <span class="n">index</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
</span><span class='line'>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isMax</span><span class="p">(</span><span class="n">buf</span><span class="p">):</span>
</span><span class='line'>                    <span class="k">return</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>                <span class="k">else</span><span class="p">:</span>
</span><span class='line'>                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>                    <span class="n">index</span> <span class="o">%=</span> <span class="n">length</span>
</span><span class='line'>                    <span class="k">if</span> <span class="n">num</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">!=</span> <span class="n">buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span class='line'>                        <span class="n">buf</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>                        <span class="n">buf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">isMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>Min Stack</h3>

<h5>question</h5>

<p>Design a stack that supports push, pop, top, and retrieving the minimum element in constant time.</p>

<pre><code>* push(x) -- Push element x onto stack.
* pop() -- Removes the element on top of the stack.
* top() -- Get the top element.
* getMin() -- Retrieve the minimum element in the stack.
</code></pre>

<h5>Basic logic</h5>

<p>The key is to maintain double stack: one for normal push() and pop(), the other for the operation getMin(). When a new min value is pushed, we also push it to the min_stack, when it pops, we also pop it from min_stack. So the minimum value is always on the top of min_stack.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">MinStack</span><span class="p">:</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">minStack</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># @param x, an integer</span>
</span><span class='line'>    <span class="c"># @return an integer</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minStack</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minStack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">minStack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># @return nothing</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">minStack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">minStack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># @return an integer</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">top</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># @return an integer</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">getMin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minStack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>Fraction to Recurring Decimal</h3>

<h5>Question</h5>

<h5>Basic logics.</h5>

<p>Easy job, just a little bit tedious. By implementing a long divide, we can easily find the answer. Remember to store every ( quotient，remainder )pairs so that we can know when it starts repeat itself. The python test case is wrong. See <a href="https://leetcode.com/discuss/28804/result-of-test-case-1-214748364-should-be-repeating-decimal">this post</a>. After this solution, I turned to C++, which should have better judge system.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Solution</span><span class="p">():</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">pass</span>
</span><span class='line'>    <span class="c"># @return a string</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">fractionToDecimal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># corner case</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">numerator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="s">&#39;0&#39;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># if no decimal number</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">numerator</span> <span class="o">%</span> <span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span> <span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span> <span class="p">)</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="c"># reduction of a fraction, not necessary</span>
</span><span class='line'>            <span class="n">fraction</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'>            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
</span><span class='line'>                <span class="k">while</span> <span class="n">fraction</span> <span class="o">&lt;=</span> <span class="nb">min</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">numerator</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span> <span class="p">):</span>
</span><span class='line'>                    <span class="k">if</span> <span class="n">numerator</span> <span class="o">%</span> <span class="n">fraction</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">denominator</span> <span class="o">%</span> <span class="n">fraction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>                        <span class="n">numerator</span> <span class="o">/=</span> <span class="n">fraction</span>
</span><span class='line'>                        <span class="n">denominator</span> <span class="o">/=</span> <span class="n">fraction</span>
</span><span class='line'>                        <span class="k">break</span>
</span><span class='line'>                    <span class="n">fraction</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>                <span class="c"># if it&#39;s end, end it. else ,restart again</span>
</span><span class='line'>                <span class="k">if</span> <span class="n">fraction</span> <span class="o">&gt;=</span> <span class="nb">min</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">numerator</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span> <span class="p">):</span>
</span><span class='line'>                    <span class="k">break</span>
</span><span class='line'>                <span class="n">fraction</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'>
</span><span class='line'>            <span class="c"># Decomposition quality factor to find if demimal repeated itself, not necessary.</span>
</span><span class='line'>            <span class="n">denom</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span>
</span><span class='line'>            <span class="k">while</span> <span class="n">denom</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>                    <span class="n">denom</span> <span class="o">/=</span> <span class="mi">2</span>
</span><span class='line'>            <span class="k">while</span> <span class="n">denom</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>                    <span class="n">denom</span> <span class="o">/=</span><span class="mi">5</span>
</span><span class='line'>            <span class="n">repeated</span> <span class="o">=</span> <span class="n">denom</span> <span class="o">!=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">result_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>            <span class="c"># get the symbol of final result</span>
</span><span class='line'>            <span class="k">if</span> <span class="n">numerator</span><span class="o">*</span><span class="n">denominator</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>                <span class="n">result_list</span> <span class="o">+=</span> <span class="p">[(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">)]</span>
</span><span class='line'>            <span class="n">numerator</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">numerator</span><span class="p">)</span>
</span><span class='line'>            <span class="n">denominator</span> <span class="o">=</span> <span class="nb">abs</span> <span class="p">(</span><span class="n">denominator</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="c"># start long divide loop( core algo )</span>
</span><span class='line'>            <span class="n">add_dot</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class='line'>            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
</span><span class='line'>                <span class="c"># long divide</span>
</span><span class='line'>                <span class="n">quotient</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>
</span><span class='line'>                <span class="n">remainder</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">%</span> <span class="n">denominator</span>
</span><span class='line'>                <span class="n">numerator</span> <span class="o">=</span> <span class="n">remainder</span>
</span><span class='line'>
</span><span class='line'>                <span class="c"># check if repreated, if not, ready for the next division</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="n">remainder</span><span class="p">,</span> <span class="n">quotient</span><span class="p">)</span> <span class="ow">in</span> <span class="n">result_list</span><span class="p">:</span>
</span><span class='line'>                    <span class="n">repreat_start_locaation</span> <span class="o">=</span> <span class="n">result_list</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="n">remainder</span><span class="p">,</span> <span class="n">quotient</span><span class="p">))</span>
</span><span class='line'>                    <span class="n">result_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span> <span class="n">repreat_start_locaation</span><span class="p">,</span> <span class="p">(</span> <span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;(&#39;</span> <span class="p">)</span> <span class="p">)</span>
</span><span class='line'>                    <span class="n">result_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="s">&#39;)&#39;</span> <span class="p">,</span> <span class="s">&#39;)&#39;</span> <span class="p">)</span> <span class="p">)</span>
</span><span class='line'>                    <span class="k">break</span>
</span><span class='line'>
</span><span class='line'>                <span class="c"># append this result of division</span>
</span><span class='line'>                <span class="n">result_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">remainder</span><span class="p">,</span> <span class="n">quotient</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>                <span class="c"># if remainder is 0, it&#39;s not a repreated number                    </span>
</span><span class='line'>                <span class="k">if</span> <span class="n">remainder</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>                    <span class="k">break</span>
</span><span class='line'>                <span class="k">if</span> <span class="n">add_dot</span><span class="p">:</span>
</span><span class='line'>                    <span class="n">result_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>                    <span class="n">add_dot</span> <span class="o">=</span> <span class="bp">False</span>
</span><span class='line'>                <span class="n">numerator</span> <span class="o">*=</span> <span class="mi">10</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>                <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
</span><span class='line'>                    <span class="k">break</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>            <span class="c"># construck result</span>
</span><span class='line'>            <span class="n">result_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span class='line'>            <span class="n">result_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>                <span class="n">remainder</span><span class="p">,</span> <span class="n">quotient</span> <span class="o">=</span> <span class="n">result_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span class='line'>                <span class="n">result_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">quotient</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">result_str</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/27/gsoc2015-blog-test/">GSoC2015_blog_test</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-27T12:52:17+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:52 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just a post to test if catagory and rss feed works well.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/08/03/opfromgraph-dot-c-code/">OpfromGraph.c_code</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/18/put-hand-on-opfromgraph/">Putting Hand on OpFromGraph</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/04/newpost/">Evaluation Passed and the Next Step: OpFromGraph</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/21/the-second-two-week/">The Second Two-week</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/17/second-look-into-theano-core/">Second_look_into_Theano_core</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/ChienliMa">@ChienliMa</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'ChienliMa',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/maqianlie@gmail.com?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Chienli Ma -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>

<a href='https://plus.google.com/106773524461336322194/posts' target='_blank'>
  <img src='/images/footer/googleplus.png' align=right style="display:inline;margin:2px 2px 2px 5px;">
</a>

<a href='https://www.facebook.com/profile.php?id=100003595780888' target='_blank'>
  <img src='/images/footer/facebook.png' align=right style="display:inline;margin:2px 2px 2px 5px;">
</a>

<a href='https://twitter.com/chienli_ma' target='_blank'>
  <img src='/images/footer/twitter.png' align=right style="display:inline;margin:2px 2px 2px 5px;">
</a>

<a href='https://lnkd.in/bDnu8WG' target='_blank'>
  <img src='/images/footer/linkedin.png' align=right style="display:inline;margin:2px 2px 2px 5px;">
</a>

</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>









</body>
</html>
